<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Ice Shelf/Ocean Fluid- and Thermodynamics: a suite of tools and programs to use for simulating the evolution of ice shelves interacting with the ocean.">
    
    <meta name="author" content="Chris MacMackin" >
    <link rel="icon" href="../../favicon.png">

    <title>Nonlinear Solvers &ndash; ISOFT</title>

    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/pygments.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/local.css" rel="stylesheet">
    
    <link  href="../../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../../js/jquery-2.1.3.min.js"></script>
    <script src="../../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">ISOFT </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../../lists/procedures.html">Procedures</a></li>
        
        
            <li><a href="../../lists/absint.html">Abstract Interfaces</a></li>
               
            <li><a href="../../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  <div class="row">
    <h1>Nonlinear Solvers</h1>
    <div class="row">
    <div class="col-lg-12">
    <div class="well well-sm" style="min-height: 40px;">
      <ul class="list-inline" style="margin-bottom:0px; display:inline">
         
        <li><i class="fa fa-pencil"></i> Chris MacMackin</li>
         
         
        <li><i class="fa fa-calendar-o"></i> November 2018</li>
         
<!--
        
-->
      </ul>
        <ol class="breadcrumb in-well">
      
         <li><a href='../../page/index.html'>Documentation</a></li>
      
         <li><a href='../../page/3-codeDesign/index.html'>Code Design</a></li>
      
         <li class="active">Nonlinear Solvers</li>
      </ol>
    </div>
    </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-md-9 col-md-push-3" id='text'>
      <h2>Ice Shelf Solver: NITSOL</h2>
<p>As <a href="../2-numerics/2-shelf-solver.html">described earlier</a>, when
integrating the ice shelf the nonlinear solver NITSOL
<a href="../6-bibliog.html#Pernice1998">(Pernice and Walker, 1998)</a> was
used. This is a legacy package written in FORTRAN77. ISOFT contains an
explicit interface to the main NITSOL subroutine so that arguments can
be checked by the compiler when it is invoked. NITSOL takes as an
argument a subroutine which receives the current estimate of the state
of the system and returns the corresponding residual according to
<a href="../2-numerics/3-shelf-solver.html#mjx-eqn-eqshelf-resid">equation 22</a>
or <a href="../2-numerics/3-shelf-solver.html#mjx-eqn-equ-resid">26</a>, depending
on whether solving for the ice
thickness or velocity. The state of the system and the residual are
both represented as 1-D arrays of real values. When the state array is
received by the residual subroutine it is used to update the value of
a field type (see <a href="./2-discretisation.html">the previous page</a>).
Operations are performed using the field type to calculate a
residual field. A 1-D array containing the data of the residual field
is then extracted and returned by the subroutine.</p>
<p>For NITSOL to converge it required a preconditioner which inverts the
Jacobian operator <script type="math/tex">\mathcal{D}_x A \equiv \partial A/\partial x +
A\Delta_x</script> (where <script type="math/tex">\Delta_x</script> is the differential operator in the
<script type="math/tex">x</script>-direction).  NITSOL receives the preconditioner as an additional
subroutine which takes as an argument an array to be preconditioned
and returns the result of that preconditioning as an array. Similarly
to the calculation of the residual, the preconditioner subroutine
converts the array to a field type, performs the preconditioning, and
then converts back to an array. As
<a href="../2-numerics/2-shelf-solver.html">previously described</a>, the operator
can be inverted by solving a tridiagonal matrix approximating the
Jacobian using finite-difference discretisation. A derived type called
a <a href="../../type/jacobian_block.html">jacobian_block</a> (see below) was written to encapsulate this
process, reinitialised every time a new value of <script type="math/tex">A</script> is needed by the
operator. This derived type is also able to represent two variations
on the <script type="math/tex">\mathcal{D}_x</script> operator: <script type="math/tex">\alpha + \mathcal{D}_x X</script>, where
<script type="math/tex">\alpha</script> is a scalar; and <script type="math/tex">\mathcal{D}_x A\Delta_x</script>. In addition
to inverting the operator on a field, <a href="../../type/jacobian_block.html">jacobian_block</a> objects can
apply the forward operator to fields.</p>
<p><img alt="UML class diagram for the preconditioner used with the ice shelf solver." src="../../media/precond.png"></p>
<p><img alt="UML class diagram for the preconditioner inverting the finite-difference operator." src="../../media/precond_001.png"></p>
<p><img alt="UML class diagram for the preconditioner inverting the pseudo-spectral differentiation operator." src="../../media/precond_002.png"></p>
<h2>Plume Solver: QLM</h2>
<p>The plume is solved using the
<a href="../2-numerics/4-plume-solver.html">quasi-linearisation method</a> (QLM).
As the QLM is an obscure algorithm, a custom implementation was
written in modern Fortran for ISOFT. It takes as arguments functions
representing the linear and nonlinear portions of the nonlinear system
of ODEs being solved. It also requires a function which computes the
product of the Jacobian of the nonlinear operator with an arbitrary
state vector and, optionally, a preconditioner function. All of these
operate on and return arrays of real data. The QLM requires solving a
linear system at each iteration and this is done using a slightly
modified version of the GMRES implementation in NITSOL. The
modification allows the GMRES solver to use an initial guess of the
solution to the linear system, rather than assume a good initial guess
to be zero (as made sense in the context of NITSOL). An explicit
interface was written to this FORTRAN77 implementation, along with a
wrapper which makes many of the arguments optional, automatically
creates the necessary work arrays, and allows for less verbose
definitions of the linear system.</p>
<p>Much as when solving for the state of the ice shelf, the linear and
nonlinear plume operators take 1-D arrays of real values as arguments.
They then use a method of the <a href="../../type/plume.html">plume</a> class to update the various fields
representing the plume variables from this array. The necessary
mathematics is performed using these fields and the results converted
back to 1-D arrays which are then returned to the QLM solver. The
preconditioner works by inverting the linear operator of the plume,
taking the anti-derivative of each variable. A derived type called the
<a href="../../type/pseudospec_block.html">pseudospec_block</a> (see figure above) was written to apply
this to field types, reversing the Chebyshev differentiation algorithm
described on pageÂ . A similar derived type called <a href="../../type/fin_diff_block.html">fin_diff_block</a>
was also written which performs the same
operation using a tridiagonal matrix representing a finite-difference
approach to differentiation. However, the much greater accuracy and
comparable computational cost of the <a href="../../type/pseudospec_block.html">pseudospec_block</a> made it the
better choice.</p>
<p>As previously mentioned, it was found that to get the level of
accuracy needed for the plume solver to converge, the product of the
Jacobian could not simply be evaluated using a finite difference
approximation. Instead, the automatic differentiation feature of the
field types described <a href="./2-discretisation.html">on the previous page</a>
was used. The vector to be multiplied by the Jacobian is used to
provide derivative values for the plume variables. The nonlinear
operator is then applied for the current plume state, with the
overloaded operators of the field types applying the chain rule at
each step to propagate the derivative. The derivative of the operator
result will then be the product of the Jacobian and the initial
vector.</p>
    </div>
    
    <div class="col-md-3 col-md-pull-9">
      <hr class="visible-xs visible-sm">
        <div class="well toc">
          <ul class="nav nav-stacked nav-pills">
            <li role="presentation" class="title"><a href='../../page/index.html'>Documentation</a></li>
          </ul>
          <hr>
          <ul class="nav nav-stacked nav-pills">
            
            <li role="presentation">
            <a href='../../page/1-running/index.html'>Using ISOFT</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/1-running/1-build.html'>Compiling the Code</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/1-running/2-writing.html'>Writing Software Using the ISOFT Framework</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/1-running/3-compile.html'>Linking to the Library</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/index.html'>Numerical Methods</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/2-numerics/1-equations.html'>Shelf/Plume Equations</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/2-spatial.html'>Spatial Discretisation</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/3-shelf-solver.html'>Shelf Solver</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/4-plume-solver.html'>Plume Solver</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/5-benchmarking.html'>Testing and Benchmarking</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/6-horzint.html'>Horizontally-Integrated Plume Equations</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/3-codeDesign/index.html'>Code Design</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/3-codeDesign/1-representing.html'>Representing the Coupled Ice Shelf/Plume</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/3-codeDesign/2-discretisation.html'>Discretisation</a>
            
            </li>
            
            <li role="presentation" class="disabled">
            <a href='../../page/3-codeDesign/3-solvers.html'>Nonlinear Solvers</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/3-codeDesign/4-parameterisations.html'>Parameterisations and Boundary Conditions</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/index.html'>Plotting ISOFT Output</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/4-plotting/1-readers.html'>Reader Objects</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/3-tools.html'>General Plotting Tools</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/5-layers.html'>Plotting Internal Layers</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/6-scripts.html'>Provided Plotting Scripts</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/./6-bibliog.html'>Bibliography</a>
            
            </li>
            
          </ul>
        </div>
    </div>
    
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ISOFT was developed by Chris MacMackin</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="../../js/MathJax-config/mj-config.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../../tipuesearch/tipuesearch_content.js"></script>
    <script src="../../tipuesearch/tipuesearch_set.js"></script>
    <script src="../../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>